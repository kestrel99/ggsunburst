% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/prepare_trajectory.R
\name{prepare_trajectory_data}
\alias{prepare_trajectory_data}
\title{Prepare Trajectory Data for Sunburst Charts}
\usage{
prepare_trajectory_data(
  data,
  subject,
  time,
  category,
  time_order = NULL,
  category_order = NULL,
  missing_handling = c("dropout", "carry_forward", "show_missing", "complete_only"),
  discontinued_label = "Discontinued",
  missing_label = "Missing",
  inner_radius = 0.25,
  segment_gap = 0.02
)
}
\arguments{
\item{data}{A data frame containing longitudinal data with one row per
subject per timepoint. Does not need to be rectangular - subjects may
have different numbers of timepoints (dropouts, late entries, missing visits).}

\item{subject}{Column name (string) for subject identifier.}

\item{time}{Column name (string) for timepoint. Must be orderable.}

\item{category}{Column name (string) for the category variable (e.g., grade).}

\item{time_order}{Character vector specifying timepoint order from inner
(earliest) to outer (latest). If NULL, uses factor levels or sorted unique values.}

\item{category_order}{Character vector specifying category order. If NULL,
uses factor levels, numeric order, or sorted unique values.}

\item{missing_handling}{How to handle subjects with missing timepoints:
\itemize{
\item \code{"dropout"} (default): Subjects who lack data at a timepoint
are marked as discontinued. When plotted, these segments are drawn
invisibly to preserve angular space, creating uneven outer borders.
\item \code{"carry_forward"}: Last observation carried forward (LOCF) -
missing timepoints use the most recent observed category.
\item \code{"show_missing"}: Missing timepoints shown as "Missing" category,
subjects continue to subsequent timepoints if data exists.
\item \code{"complete_only"}: Only include subjects with data at all timepoints.
}}

\item{discontinued_label}{Label for discontinued/dropout subjects (default "Discontinued").}

\item{missing_label}{Label for missing observations (default "Missing").}

\item{inner_radius}{Inner radius of innermost ring (default 0.25).}

\item{segment_gap}{Small gap between top-level segments in radians (default 0.02).}
}
\value{
A data frame with columns for plotting: path (trajectory string),
ring, category, count, xmin, xmax, ymin, ymax, and label positioning.
}
\description{
Convert longitudinal data into a hierarchical trajectory format for sunburst
visualization. Each subject's path through categories over time is tracked,
creating nested segments where inner ring groups subdivide in outer rings
based on category transitions.
}
\examples{
# Data with dropouts
df <- data.frame(
  subject = c(rep(1:80, each = 4), rep(81:100, each = 2)),
  visit = c(rep(c("Baseline", "Week 4", "Week 8", "Week 12"), 80),
            rep(c("Baseline", "Week 4"), 20)),
  grade = sample(0:3, 360, replace = TRUE, prob = c(0.4, 0.35, 0.2, 0.05))
)

# Show dropouts as "Discontinued"
prepared <- prepare_trajectory_data(
  df, subject = "subject", time = "visit", category = "grade",
  missing_handling = "dropout"
)

# Use LOCF for missing
prepared_locf <- prepare_trajectory_data(
  df, subject = "subject", time = "visit", category = "grade",
  missing_handling = "carry_forward"
)
}
