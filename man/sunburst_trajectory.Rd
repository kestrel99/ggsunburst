% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sunburst_trajectory.R
\name{sunburst_trajectory}
\alias{sunburst_trajectory}
\title{Create a Trajectory Sunburst Chart}
\usage{
sunburst_trajectory(
  data,
  subject,
  time,
  category,
  time_order = NULL,
  category_order = NULL,
  missing_handling = c("dropout", "carry_forward", "show_missing", "complete_only"),
  discontinued_label = "Discontinued",
  missing_label = "Missing",
  inner_radius = 0.25,
  segment_gap = 0.02,
  border_color = "white",
  border_width = 0.5,
  show_labels = "percent",
  label_orientation = "auto",
  label_size = 3.5,
  label_min_size = 2,
  label_max_size = 5,
  fit_labels = TRUE,
  label_threshold = 0.15,
  label_color = "black",
  ring_labels = TRUE,
  legend_title = NULL,
  palette = NULL,
  discontinued_color = NA,
  missing_color = "grey85",
  na_color = "grey90",
  title = NULL,
  subtitle = NULL
)
}
\arguments{
\item{data}{A data frame with longitudinal data (one row per subject per timepoint).
Does not need to be rectangular - subjects may have different numbers of
timepoints (dropouts, late entries, missing visits).}

\item{subject}{Column name for subject identifier.}

\item{time}{Column name for timepoint.}

\item{category}{Column name for category variable (e.g., grade, response).}

\item{time_order}{Order of timepoints from inner (earliest) to outer (latest).}

\item{category_order}{Order of categories for consistent segment ordering.}

\item{missing_handling}{How to handle subjects with missing timepoints:
\itemize{
\item \code{"dropout"} (default): Subjects who lack data at a timepoint
have their segments drawn invisibly (no fill, no border) to preserve
angular space. This creates an uneven outer border showing where
dropouts occurred.
\item \code{"carry_forward"}: Last observation carried forward (LOCF) -
missing timepoints use the most recent observed category.
\item \code{"show_missing"}: Missing timepoints shown as "Missing" category,
subjects continue to subsequent timepoints if data exists.
\item \code{"complete_only"}: Only include subjects with data at all timepoints.
}}

\item{discontinued_label}{Label for discontinued/dropout subjects (default "Discontinued").}

\item{missing_label}{Label for missing observations (default "Missing").}

\item{inner_radius}{Inner radius of innermost ring (default 0.25).}

\item{segment_gap}{Gap between top-level category segments (default 0.02).}

\item{border_color}{Color of borders between segments (default "white").}

\item{border_width}{Width of borders (default 0.5).}

\item{show_labels}{What labels to show: "percent", "count", "category", "none",
or combinations like c("category", "percent").}

\item{label_orientation}{How to orient labels: "auto" (default, chooses best
fit), "radial" (text radiates from center), "tangential" (text follows arc),
or "horizontal" (always horizontal).}

\item{label_size}{Base size for labels (default 3.5). With fit_labels=TRUE,
this is the target size that gets adjusted per segment.}

\item{label_min_size}{Minimum label size when auto-fitting (default 2).}

\item{label_max_size}{Maximum label size when auto-fitting (default 5).}

\item{fit_labels}{Automatically fit labels to segments? TRUE (default) adjusts
size and hides labels that don't fit. FALSE uses fixed size with threshold.}

\item{label_threshold}{Minimum segment width (radians) to show labels when
fit_labels=FALSE (default 0.15).}

\item{label_color}{Color for labels (default "black").}

\item{ring_labels}{Show ring (timepoint) labels? Default TRUE.}

\item{legend_title}{Title for the fill legend.}

\item{palette}{Color palette: named vector, "ctcae", "severity", or NULL.}

\item{discontinued_color}{Color for discontinued subjects (default "grey70").}

\item{missing_color}{Color for missing observations (default "grey85").}

\item{na_color}{Color for NA values (default "grey90").}

\item{title}{Chart title.}

\item{subtitle}{Chart subtitle.}
}
\value{
A ggplot2 object.
}
\description{
Create a sunburst chart showing how groups flow between categories over time.
Each segment in the inner ring represents a group of subjects with that
category at the first timepoint. Moving outward, each group subdivides based
on the category at subsequent timepoints, showing transitions.
}
\examples{
# Create data with dropouts
set.seed(42)
ae_data <- create_example_trajectory_data(
  n_subjects = 80, seed = 42,
  dropout_rate = 0.15
)

# Default: dropouts are simply omitted from subsequent rings
sunburst_trajectory(
  ae_data,
  subject = "subject",
  time = "visit",
  category = "grade",
  palette = "ctcae",
  missing_handling = "dropout",
  title = "AE Grade Trajectories (dropouts omitted)"
)

# Use LOCF for missing values (impute last observed)
sunburst_trajectory(
  ae_data,
  subject = "subject",
  time = "visit",
  category = "grade",
  missing_handling = "carry_forward",
  palette = "ctcae"
)
}
